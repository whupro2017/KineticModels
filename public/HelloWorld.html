<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8">
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Hello World!</title>
    <script src="cesium/Cesium.js"></script>
    <script src="cesium/Sandcastle-header.js"></script>
    <style>
        @import url(cesium/bucket.css);
        #toolbar {
            background: rgba(42, 42, 42, 0.8);
            padding: 4px;
            border-radius: 4px;
        }
        #terrainMenu {
            background: rgba(42, 42, 42, 0.8);
            padding: 4px;
            border-radius: 4px;
        }
        html, body, #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<div id="terrainMenu"></div>
<script>
    var viewer = new Cesium.Viewer('cesiumContainer', {
        shouldAnimate: true,
        homeButton: false,       //是否显示home键
        baseLayerPicker: false, //是否显示图层选择控件d
        timeline: false,        //是否显示时间线控件
        fullscreenButton: false, //是否全屏显示
        scene3DOnly: true,     //如果设置为true，则所有几何图形以3D模式绘制以节约GPU资源
        infoBox: true,         //是否显示点击要素之后显示的信息
        sceneModePicker: false,  //是否显示投影方式控件  三维/二维
        navigationInstructionsInitiallyVisible: false,
        navigationHelpButton: false,     //是否显示帮助信息控件
        selectionIndicator: false,        //是否显示指示器组件
        //terrainProvider : Cesium.createWorldTerrain(),   //加载地势
        imageryProvider: new Cesium.createTileMapServiceImageryProvider({
            url: 'cesium/googleTMS',
        })
    });
    viewer._cesiumWidget._creditContainer.style.display = "none";  //	去除版权信息
    var scene = viewer.scene;
    var clock = viewer.clock;
    viewer.extend(Cesium.viewerCesiumInspectorMixin);
    var options = [{
        text: '卡车模型',
        onselect: function () {
            console.log("卡车模型");
        }
    }];
    Sandcastle.addToolbarButton('View Aircraft', function () {
        viewer.trackedEntity = entity;
    });
    Sandcastle.addToolbarMenu(options,'terrainMenu');
    var czml = [{
        "id": "document",
        "name": "CZML_Model",
        "version": "1.0",
        "clock": {
            "interval": "2018-07-19T15:18:00Z/2018-07-19T15:19:00Z",
            "currentTime": "2018-07-19T15:18:00Z",
            "multiplier": 5,
            "range": "LOOP_STOP",
            "step": "SYSTEM_CLOCK_MULTIPLIER"
        }
    }, {
        "id": "aircraft_model",
        "name": "Cesium Air",
           "position": {
            "cartographicDegrees": [
                "2018-07-19T15:18:00Z", 78.01, 37, 1000,
                "2018-07-19T15:19:00Z", 78.02, 37, 1000,
            ]
        },
        "model": {
            "gltf": "cesium/Models/CesiumAir/Cesium_Air.glb",
            "scale": 2.0,
           // "minimumPixelSize": 128
        },

    }, {
        "id": "man_model",
        "name": "Cesium Man",
             "position": {
            "cartographicDegrees": [-78, 38, 11]
        },
        "model": {
            "gltf": "cesium/Models/CesiumMan/Cesium_Man.glb",
            "scale": 20.0,
        },
    }, {
        "id": "GroundVehicle_model1",
        "name": "Cesium GroundVehicle",
        "position": {
            "cartographicDegrees": [
                "2018-07-19T15:18:00Z", -78.01, 37, 10,
                "2018-07-19T15:18:40Z", -78.0052, 37, 10,
                "2018-07-19T15:19:00Z", -78.00519, 37, 10
            ]
        },
        "model": {
            "gltf": "cesium/Models/GroundVehicle/GroundVehicle.glb",
            "scale": 20.0,
            //"minimumPixelSize": 128
        },
    }, {
        "id": "GroundVehicle_model2",
        "name": "Cesium GroundVehicle",
        "position": {
            "cartographicDegrees": [
                "2018-07-19T15:18:00Z", -78.00, 37, 10,
                "2018-07-19T15:18:40Z", -78.0040, 37, 10,
                "2018-07-19T15:19:00Z", -78.00401, 37, 10
            ]
        },
        "model": {
            "gltf": "cesium/Models/GroundVehicle/GroundVehicle.glb",
            "scale": 20.0,
            //"minimumPixelSize": 128
        },
    }, {
        "id": "Fire_Model",
        "name": "Cesium Fire_Model",
        "position": {
            "cartographicDegrees": [
                "2018-07-19T15:18:40Z", -78.0045, 37, 10,
                "2018-07-19T15:19:00Z", -78.0045, 37, 10
            ]
        },
        "model": {
            "gltf": "cesium/Models/house.gltf",
            "scale": 0.10,
            //"minimumPixelSize": 28,
            "maxmumPixelSize": 200
        },
    }];

    var dataSourcePromise = viewer.dataSources.add(Cesium.CzmlDataSource.load(czml));
    var modelMatrix1 = Cesium.Transforms.eastNorthUpToFixedFrame(
        Cesium.Cartesian3.fromDegrees(-78.0045, 37, 0));        //gltf数据加载位置
    var model = scene.primitives.add(Cesium.Model.fromGltf({
        url: 'cesium/Models/split0.gltf',        //如果为bgltf则为.bgltf
        modelMatrix: modelMatrix1,
        scale: 1.0 ,    //放大倍数
        minimumPixelSize: 12800,
    }));
    dataSourcePromise.then(function (dataSource) {
        console.log("xxxxx");
        var s = dataSource.entities.getById('GroundVehicle_model2');
        console.log(s.id.toString());
        s.orientation = new Cesium.VelocityOrientationProperty(s.position);
        viewer.trackedEntity = dataSource.entities.getById('GroundVehicle_model');
        viewer.trackedEntity = s;
    });
    var handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
    var fragmentShaderSource =
        'uniform sampler2D colorTexture;\n' +
        'varying vec2 v_textureCoordinates;\n' +
        'uniform vec4 highlight;\n' +
        'void main() {\n' +
        '    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n' +
        '    if (czm_selected()) {\n' +
        '        vec3 highlighted = highlight.a * highlight.rgb + (1.0 - highlight.a) * color.rgb;\n' +
        '        gl_FragColor = vec4(highlighted, 1.0);\n' +
        '    } else { \n' +
        '        gl_FragColor = color;\n' +
        '    }\n' +
        '}\n';
    var stage = scene.postProcessStages.add(new Cesium.PostProcessStage({
        fragmentShader: fragmentShaderSource,
        uniforms: {
            highlight: function () {
                return new Cesium.Color(1.0, 0.0, 0.0, 0.5);
            }
        }
    }));
    handler.setInputAction(function (movement) {
            //当鼠标移动时获取移动的末位置
            var pick = scene.pick(movement.endPosition);
            //简单来说就是这个点上有东西，那就打log
            if (Cesium.defined(pick) && Cesium.defined(pick.node) && Cesium.defined(pick.mesh)) {
                stage.selected = [pick.primitive];
                console.log('node: ' + pick.node.name + '. mesh: ' + pick.mesh.name);
            } else {
                stage.selected = [];
            }
        },
        Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    handler.setInputAction(function (movement) {
        var windowPosition = viewer.camera.getPickRay(movement.position);
        var cartesianCoordinates = viewer.scene.globe.pick(windowPosition, viewer.scene);
        var cartoCoordinates = viewer.scene.globe.ellipsoid.cartesianToCartographic(cartesianCoordinates);
        console.log(Cesium.Math.toDegrees(cartoCoordinates.longitude)
            + "," +
            Cesium.Math.toDegrees(cartoCoordinates.latitude)
            + "," +
            Cesium.Math.toDegrees(cartoCoordinates.height))
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    /*viewer.camera.flyTo({
         destination : Cesium.Cartesian3.fromDegrees(-78, 37,6000.0)     //相机飞入点
     }); */
    // var options = [{
    //     text: '指纹要素',
    //     onselect: function () {
    //         console.log("指纹要素");
    //     }
    // }];
    // Sandcastle.addToolbarButton('View Aircraft', function () {
    //     viewer.trackedEntity = entity;
    // });
    // Sandcastle.addToolbarMenu(options);
    // Sandcastle.addToolbarMenu([{
    //     text : 'CesiumTerrainProvider - Cesium World Terrain',
    //     onselect : function() {
    //         viewer.terrainProvider = worldTerrain;
    //         viewer.scene.globe.enableLighting = true;
    //     }
    // }, {
    //     text : 'CesiumTerrainProvider - Cesium World Terrain - no effects',
    //     onselect : function() {
    //         viewer.terrainProvider = Cesium.createWorldTerrain();
    //     }
    // }, {
    //     text : 'CesiumTerrainProvider - Cesium World Terrain w/ Lighting',
    //     onselect : function() {
    //         viewer.terrainProvider = Cesium.createWorldTerrain({
    //             requestVertexNormals : true
    //         });
    //         viewer.scene.globe.enableLighting = true;
    //     }
    // }, {
    //     text : 'CesiumTerrainProvider - Cesium World Terrain w/ Water',
    //     onselect : function() {
    //         viewer.terrainProvider = Cesium.createWorldTerrain({
    //             requestWaterMask : true
    //         });
    //     }
    // }, {
    //     text : 'EllipsoidTerrainProvider',
    //     onselect : function() {
    //         viewer.terrainProvider = ellipsoidProvider;
    //     }
    // }, {
    //     text : 'VRTheWorldTerrainProvider',
    //     onselect : function() {
    //         viewer.terrainProvider = vrTheWorldProvider;
    //     }
    // }], 'terrainMenu');

</script>
</body>
</html>
